{% extends "basic-structure-w-sidebar.html" %}
{% from "common/_form.html" import render_form %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
  <a href="{{ url_for('sites.index') }}" 
     class="mb-4 inline-block rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 shadow hover:bg-gray-200">
    ← Volver al listado
  </a>

  <h2 class="text-2xl font-bold mb-6">Agregar sitio histórico</h2>

  {% call render_form(
        action=url_for('sites.add_site'),
        fields=[
          {"name": "nombre","label": "Nombre","type":"text","placeholder":"Nombre del sitio","required":True },
          {"name": "descripcion_breve","label":"Descripción breve","type":"text","placeholder":"Breve descripción","required":true},
          {"name": "descripcion_completa","label":"Descripción completa","type":"text","placeholder":"Descripción completa","required":true},
          {"name": "ciudad","label":"Ciudad","type":"text","placeholder":"Ciudad","required":True},
          {"name": "provincia","label": "Provincia","type": "select", "options": provincias, "required": True},
          {"name": "inauguracion","label":"Año de inauguración","type":"number","placeholder":"Año de inauguración","max":2025,"required":True},
          {"name": "estado_conservacion","label":"Estado de conservación","type":"select","options":[{"value":"Bueno","label":"Bueno"},{"value":"Regular","label":"Regular"},{"value":"Malo","label":"Malo"}],"required":True},
          {"name": "categoria","label":"Categoría","type":"text","placeholder":"Categoría del sitio","required":True},
          {"name": "visible" ,"label":"Visible","type":"checkbox","checked":True}
          ],submit_text="Agregar sitio histórico"
        ) %}
    
    <div class="mt-6">
      <label class="block font-semibold mb-2">Ubicación en el mapa</label>
      <div id="map" class="w-full h-96 border border-gray-300 rounded-lg"></div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
        <div>
          <label for="latitud" class="block mb-1">Latitud</label>
          <input type="number" step="any" id="latitud" name="latitud" class="border rounded p-2 w-full" readonly>
        </div>
        <div>
          <label for="longitud" class="block mb-1">Longitud</label>
          <input type="number" step="any" id="longitud" name="longitud" class="border rounded p-2 w-full" readonly>
        </div>
      </div>
    </div>
    <div class="flex justify-center mt-6">
 
</div>
  {% endcall %}
</div>



<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script>
  const map = L.map('map').setView([-34.6037, -58.3816], 5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  let marker;
  map.on('click', function(e) {
    const lat = e.latlng.lat.toFixed(6);
    const lng = e.latlng.lng.toFixed(6);
    document.getElementById('latitud').value = lat;
    document.getElementById('longitud').value = lng;
    if (marker) map.removeLayer(marker);
    marker = L.marker([lat, lng]).addTo(map);
  });
</script>


{% endblock %}

