{% extends "basic-structure-w-sidebar.html" %}
{% from "common/_form.html" import render_form %}

{% block content %}
 <h2 class="text-2xl font-bold mb-4">Agregar sitio histórico</h2>
  {% call render_form(
        action=url_for('sites.add_site'),
        fields=[
          {"name": "nombre","label": "Nombre","type":"text","placeholder":"Nombre del sitio","required":True},
          {"name": "descripcion_breve","label":"Descripción breve","type":"text","placeholder":"Breve descripción"},
          {"name": "descripcion_completa","label":"Descripción completa","type":"text","placeholder":"Descripción completa"},
          {"name": "ciudad","label":"Ciudad","type":"text","placeholder":"Ciudad","required":True},
          {"name": "provincia","label":"Provincia","type":"text","placeholder":"Provincia","required":True},
          {"name": "Estado de conservacion","label":"Estado de conservación","type":"select","options":[{"value":"Bueno","label":"Bueno"},{"value":"Regular","label":"Regular"},{"value":"Malo","label":"Malo"}],"required":True},
          {"name": "categoria","label":"Categoría","type":"text","placeholder":"Categoría del sitio","required":True},
          {"name": "visible" ,"label":"Visible","type":"checkbox","checked":True}
          ],
        submit_text="Agregar sitio") %}
    <label class="block font-semibold mt-4">Ubicación en el mapa</label>
    <div id="map" class="w-full h-96 border border-gray-300 rounded-lg"></div>

    <div class="flex gap-4 mt-4">
      <div class="flex-1">
        <label for="latitud">Latitud</label>
        <input type="number" step="any" id="latitud" name="latitud" class="border rounded p-2 w-full" readonly>
      </div>
      <div class="flex-1">
        <label for="longitud">Longitud</label>
        <input type="number" step="any" id="longitud" name="longitud" class="border rounded p-2 w-full" readonly>
      </div>
    </div> 
  {% endcall %}

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script>
    const map = L.map('map').setView([-34.6037, -58.3816], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    let marker;
    map.on('click', function(e) {
      const lat = e.latlng.lat.toFixed(6);
      const lng = e.latlng.lng.toFixed(6);
      document.getElementById('latitud').value = lat;
      document.getElementById('longitud').value = lng;
      if (marker) map.removeLayer(marker);
      marker = L.marker([lat, lng]).addTo(map);
    });
  </script>
{% endblock %}
