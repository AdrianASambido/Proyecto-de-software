{% extends "common/tables_base.html" %}

{% block table_title %}Lista de Usuarios{% endblock %}
{% block add_url %}{{ url_for('users.add_user') }}{% endblock %}
{% block add_label %}Agregar Usuario{% endblock %}

{% block table_filters %}
<form method="get" class="mb-3 flex flex-wrap items-center gap-2 text-sm">
    <!-- Búsqueda -->
    <input type="text" name="email" placeholder="Buscar email..." value="{{ request.args.get('email','') }}"
        class="h-8 w-40 rounded border border-neutral-600 bg-neutral-900 px-2 text-neutral-200" />
    <!-- Rol -->
    <select name="rol" class="h-8 w-32 rounded border border-neutral-600 bg-neutral-900 px-2 text-neutral-200">
        <option value="">Rol</option>
        {% for role in roles %}
            <option value="{{ role.id }}" {% if filtros.get('rol')|int == role.id %}selected{% endif %}>
                {{ role.name }}
            </option>
        {% endfor %}
    </select>
    <!-- Activo-->
    <select name="activo" class="h-8 w-24 rounded border border-neutral-600 bg-neutral-900 px-2 text-neutral-200">
        <option value="">Todos</option>
        <option value="1" {% if filtros.get('activo') == '1' %}selected{% endif %}>Sí</option>
        <option value="0" {% if filtros.get('activo') == '0' %}selected{% endif %}>No</option>
    </select>

    <!-- Botones -->
    <button type="submit" class="h-8 rounded bg-blue-600 px-3 text-white hover:bg-blue-500">Aplicar</button>
    <a href="{{url_for('users.index')}}" class="h-8 rounded bg-blue-600 px-3 text-white hover:bg-blue-500">Limpiar</a>

    <!-- Orden -->
    <select name="orden" class="h-8 w-28 rounded border border-neutral-600 bg-neutral-900 px-2 text-neutral-200">
        <option value="fecha_desc" {% if request.args.get('orden')=='fecha_desc' %}selected{% endif %}>Fecha ↓</option>
        <option value="fecha_asc" {% if request.args.get('orden')=='fecha_asc' %}selected{% endif %}>Fecha ↑</option>
    </select>
</form>
{% endblock %}

{% block table_headers %}
<th class="px-3 py-2 text-left">Email</th>
<th class="px-3 py-2 text-left">Nombre</th>
<th class="px-3 py-2 text-left">Apellido|s|</th>
<th class="px-3 py-2 text-left">Activo</th>
<th class="px-3 py-2 text-left">Rol|es|</th>
{% endblock %}

{% block table_rows %}
    {% for user in items %}
    <tr>
        <td>{{ user.email }}</td>
        <td>{{ user.nombre }}</td>
        <td>{{ user.apellido }}</td>
        <td>
            {% if user.activo %}
                <span class="text-green-500 font-semibold">Activo</span>
            {% else %}
                <span class="text-red-500 font-semibold">Inactivo</span>
            {% endif %}
        </td>
        <td>
            {% for role in user.roles %}
                <span class="px-2 py-1 bg-blue-900 text-blue-300 rounded">{{ role.name }}</span>
            {% else %}
                <span class="text-neutral-400 italic">Sin rol</span>
        {% endfor %}
        </td>
        <td class="text-right">
         
            {% set details_url = url_for('users.user_detail', user_id = user.id) %}
      {% set edit_url = url_for('users.edit_user_admin', user_id=user.id) %}
     
        {% set delete_url = url_for('users.delete_user', user_id=user.id) %}
     
        {% include "common/actions.html" %} 
    </tr>
    {% else %}
    <tr>
      <td colspan="13" class="text-center text-white-500 py-4">
        No hay usuarios guardados.
      </td>
    </tr>
    {% endfor %}
    {% include "common/delete_modal.html" %}
{% endblock %}